<!-- Hello. see /doc.txt for explanations on the used CSS/HTML5 techniques
  without javascript. -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="description" content="document organizer with tags and full-text-search, in a simple and clean sqlite3 schema">
  <title>bibliothecula</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta property="og:type" content="website">
  <meta property="og:image" content="https://nessuent.xyz/bibliothecula.png">
  <meta property="og:site_name" content="bibliothecula - tagged document storage">
  <meta property="og:title" content="bibliothecula - tagged document storage">
  <link rel="preload" href="./css/fonts/Amstelvar-Roman-VF.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="./css/style.css" as="style">
  <link rel="stylesheet" media="all" href="./css/style.css" />
</head>
<body class="index">
  <figure id="grid-zoom" class="zoom">
    <a class="zoom" href="#web-gui"><img width="1908" height="982" src='./img/screenshot-grid-view.webp' alt="grid view" decoding="async" loading="lazy"></a>
    <figcaption> grid view (<em>click to close</em>) </figcaption>
  </figure>
  <figure id="full-text-grid-zoom" class="zoom">
    <a class="zoom" href="#web-gui"><img width="808"  height="1006"  src='./img/screenshot-full-text-grid-property.webp' alt="full-text search on grid view" decoding="async" loading="lazy"></a>
    <figcaption> full-text search on grid view (<em>click to close</em>) </figcaption>
  </figure>
  <figure id="full-text-table-zoom" class="zoom">
    <a class="zoom" href="#web-gui"><img width="1908"  height="1010"  src='./img/screenshot-full-text-table-property.webp' alt="and on table view" decoding="async" loading="lazy"></a>
    <figcaption> and on table view (<em>click to close</em>) </figcaption>
  </figure>
  <figure id="database-zoom" class="zoom">
    <a class="zoom" href="#web-gui"><img width="1908"  height="5765"  src='./img/screenshot-database-view.webp' alt="database view" decoding="async" loading="lazy"></a>
    <figcaption> database view (<em>click to close</em>) </figcaption>
  </figure>
  <figure id="d3-zoom" class="zoom">
    <a class="zoom" href="#web-gui"><img width="1908" height="1384" src='./img/screenshot-d3-tag-graph.webp' alt="d3.js tag visualization" decoding="async" loading="lazy"></a>
    <figcaption>
      <a href="https://bl.ocks.org/heybignick/3faf257bbbbc7743bb72310d03b86ee8" rel="external nofollow" class="decorate"><code class="filename">d3<wbr>.<wbr>js</code></a> tag visualization (<em>click to close</em>)
    </figcaption>
  </figure>
  <figure id="document-zoom" class="zoom">
    <a class="zoom" href="#web-gui"><img width="1631" height="539" src='./img/screenshot-document-view.webp' alt="document view" decoding="async" loading="lazy"></a>
    <figcaption> document view (<em>click to close</em>) </figcaption>
  </figure>
  <header aria-label="logo and bibliothecula name">
    <details class="click"><summary><span class="banner shadow" aria-hidden="true">bibliothecula</span><span class="banner click" title="the colorscheme of the page is inspired by the cover of the first edition of Dracula by Bram Stoker in 1897.">bibliothecula</span></summary></details>
    <picture>
      <source srcset="./img/logo.webp 420w" type="image/webp">
      <img class="logo" width="420" height="418" src="./img/logo.png" alt="bibliothecula logo" title="Illustration of bat from De arte venandi cum avibus by HRE Frederick II (circa 1240s). It's a visual pun because it looks like an open book viewed from above, and also bibliothecula shares a suffix with the word Dracula.">
    </picture>
  </header>
  <blockquote title="dictionary and project definitions of bibliothecula">
    <p class="def"><em>bibliothēcula</em> f (genitive <span class="nobr"><em>bibliothēculae</em>&#8202;);</span> first declension (Late Latin)</p>
    <ul>
      <li>small library</li>
      <li>small collection of books</li>
      <li>document organizer <code>sqlite3</code> schema with tags and full-text-search, along with small companion tools</li>
    </ul>
  </blockquote>
  <div>
    <h2>why</h2>
    <ul>
      <li>Organise journal articles for bibliographies</li>
      <li>Organise e-books</li>
      <li>Store plain text notes with automatic full-text search and back-reference indexing (see &ldquo;<em><a href="./notekeeping.html">Using <code>sqlite3</code> as a notekeeping graph with automatic reference indexing</a></em>&rdquo;)</li>
    </ul>
  </div>
  <div>
    <h2>where</h2>
    <div class="repo">
      <strong><a rel="me" href="https://github.com/epilys/bibliothecula" class="repo">https://<wbr>github<wbr>.<wbr>com<wbr>/<wbr>epilys<wbr>/<wbr>bibliothecula<wbr></a></strong> <a rel="external nofollow" href="https://www.gnu.org/licenses/gpl-3.0-standalone.html" class="gpl"><small><abbr class="gpl" title="The GNU General Public License v3.0">GPLv3</abbr></small></a>
    </div>
  </div>
  <div>
    <h2>what <a href="https://github.com/epilys/bibliothecula/tree/main/docs" class="decorate" title="bibliothecula documentation repository directory"></a></h2>
    <p><code class="filename">schema<wbr>.<wbr>{<wbr><a href="https://github.com/epilys/bibliothecula/blob/main/docs/schema.sql" title="sql file with comments">sql</a>,<a href="https://github.com/epilys/bibliothecula/blob/main/docs/schema.md" title="markdown file with comments">md</a><wbr>}<wbr></code> and <code class="filename">extended<wbr>-<wbr>schema<wbr>.<wbr>{<wbr><a href="https://github.com/epilys/bibliothecula/blob/main/docs/extended-schema.sql" title="sql file with comments">sql</a>,<a href="https://github.com/epilys/bibliothecula/blob/main/docs/extended-schema.md" title="markdown file with comments">md</a><wbr>}</code></p>
    <pre class="scrollbox" tabindex="0" title="SQL code that produces the bibliothecula schema" role="figure">
/* core bibliothecula schema */

/* CREATE_DOCUMENTS */
CREATE TABLE IF NOT EXISTS "Documents" (
        "uuid" CHARACTER(32) NOT NULL PRIMARY KEY,
        "title" TEXT NOT NULL,
        "title_suffix" TEXT DEFAULT NULL, -- disambiguate documents with matching titles
        "created" DATETIME NOT NULL DEFAULT (strftime ('%Y-%m-%d %H:%M:%f', 'now')),
        "last_modified" DATETIME NOT NULL DEFAULT (strftime ('%Y-%m-%d %H:%M:%f', 'now'))
);

/* CREATE_TEXTMETADATA */
CREATE TABLE IF NOT EXISTS "TextMetadata" (
        "uuid" CHARACTER(32) NOT NULL PRIMARY KEY,
        "name" TEXT NULL,
        "data" TEXT NOT NULL,
        "created" DATETIME NOT NULL DEFAULT (strftime ('%Y-%m-%d %H:%M:%f', 'now')),
        "last_modified" DATETIME NOT NULL DEFAULT (strftime ('%Y-%m-%d %H:%M:%f', 'now'))
);

/* CREATE_BINARYMETADATA */
CREATE TABLE IF NOT EXISTS "BinaryMetadata" (
        "uuid" CHARACTER(32) NOT NULL PRIMARY KEY,
        "name" TEXT NULL,
        "data" BLOB NOT NULL,
        "compressed" BOOLEAN NOT NULL DEFAULT (0),
        "created" DATETIME NOT NULL DEFAULT (strftime ('%Y-%m-%d %H:%M:%f', 'now')),
        "last_modified" DATETIME NOT NULL DEFAULT (strftime ('%Y-%m-%d %H:%M:%f', 'now'))
);

/* CREATE_DOCUMENTHASTEXTMETADATA */
CREATE TABLE IF NOT EXISTS "DocumentHasTextMetadata" (
        "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
        "name" TEXT NOT NULL,
        "document_uuid" CHARACTER(32) NOT NULL
            REFERENCES "Documents" ("uuid") ON DELETE CASCADE DEFERRABLE INITIALLY DEFERRED,
        "metadata_uuid" CHARACTER(32) NOT NULL
            REFERENCES "TextMetadata" ("uuid") ON DELETE CASCADE DEFERRABLE INITIALLY DEFERRED,
        "created" DATETIME NOT NULL DEFAULT (strftime ('%Y-%m-%d %H:%M:%f', 'now')),
        "last_modified" DATETIME NOT NULL DEFAULT (strftime ('%Y-%m-%d %H:%M:%f', 'now'))
);

/* CREATE_DOCUMENTHASBINARYMETADATA */
CREATE TABLE IF NOT EXISTS "DocumentHasBinaryMetadata" (
        "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
        "name" TEXT NOT NULL,
        "document_uuid" CHARACTER(32) NOT NULL
            REFERENCES "Documents" ("uuid") ON DELETE CASCADE DEFERRABLE INITIALLY DEFERRED,
        "metadata_uuid" CHARACTER(32) NOT NULL
            REFERENCES "BinaryMetadata" ("uuid") ON DELETE CASCADE DEFERRABLE INITIALLY DEFERRED,
        "created" DATETIME NOT NULL DEFAULT (strftime ('%Y-%m-%d %H:%M:%f', 'now')),
        "last_modified" DATETIME NOT NULL DEFAULT (strftime ('%Y-%m-%d %H:%M:%f', 'now'))
);

/* CREATE_VIEW_DOCUMENTS_TITLE_AUTHORS
 Auxiliary view for use in document_title_authors_text_view_fts index.
 Returns document title and a NULL byte separated string with all
 authors or NULL for all documents.
 https://sqlite.org/lang_createview.html sqlite3 reference for for
 creating views */
CREATE VIEW document_title_authors (rowid, title, authors) AS
SELECT uuid, title, authors
FROM
    Documents AS d
    LEFT JOIN (SELECT
            document_uuid,
            GROUP_CONCAT (data, '\0') AS authors
        FROM
            DocumentHasTextMetadata AS dhtm
            JOIN TextMetadata AS tm ON dhtm.metadata_uuid = tm.uuid
        WHERE
            tm.name = 'author'
        GROUP BY
            document_uuid) AS authors ON d.uuid = authors.document_uuid;

/* FTS_CREATE_TABLE
 Create a full-text search index using the fts5 module.
 https://sqlite.org/fts5.html sqlite3 reference */
CREATE VIRTUAL TABLE IF NOT EXISTS document_title_authors_text_view_fts
    USING fts5(title, authors, full_text, uuid UNINDEXED);

/* FTS_CREATE_INSERT_TRIGGER
 Trigger to insert full text data when a DocumentHasBinaryMetadata row
 for a full-text BinaryMetadata is created.
 https://sqlite.org/lang_createtrigger.html sqlite3 reference for for
 creating triggers */
CREATE TRIGGER insert_full_text_trigger
    AFTER INSERT ON DocumentHasBinaryMetadata
WHEN EXISTS (
        SELECT
            *
        FROM
            BinaryMetadata AS bm
        WHERE
            NEW.metadata_uuid = bm.uuid
            AND bm.name = 'full-text')
BEGIN
    INSERT INTO document_title_authors_text_view_fts (
        uuid, title, authors, full_text)
SELECT
    d.rowid AS rowid, d.title AS title,
    d.authors AS authors, bm.data AS full_text
FROM
    document_title_authors AS d,
    BinaryMetadata AS bm
WHERE
    d.rowid = NEW.document_uuid
    AND bm.name = 'full-text'
    AND bm.uuid = NEW.metadata_uuid;
END;

/* FTS_CREATE_DELETE_TRIGGER
 Trigger to remove a document's full text from the full text search
 table when the full-text binary metadata is deleted.
 https://sqlite.org/lang_createtrigger.html sqlite3 reference for for
 creating triggers */
CREATE TRIGGER IF NOT EXISTS delete_full_text_trigger
       AFTER DELETE ON DocumentHasBinaryMetadata
        WHEN OLD.name = 'full-text'
       BEGIN
       DELETE FROM document_title_authors_text_view_fts
       WHERE uuid = OLD.document_uuid;
END;
</pre>
  </div>
  <div>
    <h2>stuff</h2>
    <h3>fuse filesystem <a href="https://github.com/epilys/bibliothecula/tree/main/biblfs" class="decorate" title="repository directory for biblfs, the virtual filesystem"></a></h3>
    <pre class="scrollbox" tabindex="0" title="example terminal use session of the biblfs virtual filesystem" role="figure">$ <span class="pl-s1">ls <span class="pl-k">~</span>/Documents/biblfs <span class="pl-k">|</span> head</span>
<span class="pl-c1">total 393K</span>
<span class="pl-c1">drwxr-xr-x  2 epilys epilys     0 Jan  1  1970 ./</span>
<span class="pl-c1">drwxrwxrwt 98 root   root    120K Jun 14 19:27 ../</span>
<span class="pl-c1">-rw-r--r--  1 epilys epilys  589K Jun 14 00:35 a-a-milne_the-red-house-mystery.epub</span>
<span class="pl-c1">-rw-r--r--  1 epilys epilys  450K Jun 14 00:58 aesop_fables_v-s-vernon-jones.epub</span>
<span class="pl-c1">-rw-r--r--  1 epilys epilys  601K Jun 14 00:58 agatha-christie_poirot-investigates.epub</span>
<span class="pl-c1">-rw-r--r--  1 epilys epilys  594K Jun 14 00:58 agatha-christie_the-man-in-the-brown-suit.epub</span>
<span class="pl-c1">-rw-r--r--  1 epilys epilys  523K Jun 14 00:40 agatha-christie_the-murder-on-the-links.epub</span>
<span class="pl-c1">-rw-r--r--  1 epilys epilys  780K Jun 14 00:37 agatha-christie_the-mysterious-affair-at-styles.epub</span>
<span class="pl-c1">-rw-r--r--  1 epilys epilys  651K Jun 14 00:58 agatha-christie_the-secret-adversary.epub</span>
$ <span class="pl-s1">ls <span class="pl-s"><span class="pl-pds">"</span>~/Documents/biblfs/tags/Arthurian romances<span class="pl-pds">"</span></span></span>
<span class="pl-c1">total 1.5K</span>
<span class="pl-c1">drwxr-xr-x 2 epilys epilys    0 Jan  1  1970 ./</span>
<span class="pl-c1">drwxr-xr-x 2 epilys epilys    0 Jan  1  1970 ../</span>
<span class="pl-c1">-rw-r--r-- 1 epilys epilys 817K Jun 14 00:35 alfred-lord-tennyson_idylls-of-the-king.epub</span>
<span class="pl-c1">-rw-r--r-- 1 epilys epilys 979K Jun 14 00:45 mark-twain_a-connecticut-yankee-in-king-arthurs-court.epub</span>
<span class="pl-c1">-rw-r--r-- 1 epilys epilys 1.6M Jun 14 00:39 thomas-malory_le-morte-darthur.epub</span>
$ <span class="pl-s1">ls <span class="pl-k">~</span>/Documents/biblfs/query/journal <span class="pl-k">|</span> head</span>
<span class="pl-c1">total 73K</span>
<span class="pl-c1">drwxr-xr-x 2 epilys epilys     0 Jan  1  1970 ./</span>
<span class="pl-c1">drwxr-xr-x 2 epilys epilys     0 Jan  1  1970 ../</span>
<span class="pl-c1">-rw-r--r-- 1 epilys epilys  1.1M Jun 14 00:40 alexander-hamilton_john-jay_james-madison_the-federalist-papers.epub</span>
<span class="pl-c1">-rw-r--r-- 1 epilys epilys  679K Jun 14 00:35 alexander-pushkin_eugene-onegin_henry-spalding.epub</span>
<span class="pl-c1">-rw-r--r-- 1 epilys epilys  1.7M Jun 14 00:35 alexandre-dumas_the-count-of-monte-cristo_chapman-and-hall.epub</span>
<span class="pl-c1">-rw-r--r-- 1 epilys epilys  1.1M Jun 14 00:35 alexandre-dumas_the-three-musketeers_william-robson.epub</span>
<span class="pl-c1">-rw-r--r-- 1 epilys epilys  572K Jun 14 00:35 ambrose-bierce_the-devils-dictionary.epub</span>
<span class="pl-c1">-rw-r--r-- 1 epilys epilys  664K Jun 14 00:35 anatole-france_penguin-island_a-w-evans.epub</span>
<span class="pl-c1">-rw-r--r-- 1 epilys epilys  1.1M Jun 14 00:35 anthony-trollope_the-way-we-live-now.epub</span></pre>
  </div>
  <div>
    <h3 id="web-gui">bumblebat web gui <a href="https://github.com/epilys/bibliothecula/tree/main/bumblebat" class="decorate" title="repository directory for the web GUI bibliothecula app in django"></a></h3>
    <p><a href="./web-demo/index.html">see non-interactive, static demo here</a></p>
    <div class="screenshots">
      <figure>
        <a href="#grid-zoom"><img width="400" height="206" src='./img/t-screenshot-grid-view.webp' alt="grid view" decoding="async" loading="lazy"></a>
        <figcaption>
          <a href="#grid-zoom">grid view</a>
        </figcaption>
      </figure>
      <figure>
        <a href="#full-text-grid-zoom"><img width="400"  height="498"  src='./img/t-screenshot-full-text-grid-property.webp' alt="full-text search on grid view" decoding="async" loading="lazy"></a>
        <figcaption>
          <a href="#full-text-grid-zoom">full-text search on grid view</a>
        </figcaption>
      </figure>
      <figure>
        <a href="#full-text-table-zoom"><img width="400"  height="212"  src='./img/t-screenshot-full-text-table-property.webp' alt="and on table view" decoding="async" loading="lazy"></a>
        <figcaption>
          <a href="#full-text-table-zoom">and on table view</a>
        </figcaption>
      </figure>
      <figure>
        <a href="#database-zoom"><img width="400"  height="1209"  src='./img/t-screenshot-database-view.webp' alt="database view" decoding="async" loading="lazy"></a>
        <figcaption>
          <a href="#database-zoom">database view</a>
        </figcaption>
      </figure>
      <figure id="d3">
        <a href="#d3-zoom"><img width="400" height="290" src='./img/t-screenshot-d3-tag-graph.webp' alt="d3.js tag visualization" decoding="async" loading="lazy"></a>
        <figcaption>
          <a href="#d3-zoom"><code class="filename">d3<wbr>.<wbr>js</code> tag visualization</a>
        </figcaption>
      </figure>
      <figure>
        <a href="#document-zoom"><img width="400" height="132" src='./img/t-screenshot-document-view.webp' alt="document view" decoding="async" loading="lazy"></a>
        <figcaption>
          <a href="#document-zoom">document view</a>
        </figcaption>
      </figure>
    </div>
  </div>
  <div>
    <h3 id="shell">shell <a href="https://github.com/epilys/bibliothecula/blob/main/bibl-shell.py" class="decorate" title="repository directory for the shell app"></a></h3>
    <p>manage your database through the powerful <code>python3</code> or <code>IPython3</code> interactive shells with convenience wrappers around common database operations including viewing, editing, adding and removing files.</p>
    <pre class="scrollbox" tabindex="0" title="banner text shown to user when starting the bibl-shell tool" role="figure">% <span class="pl-s1">python3.7 bibl-shell.py bibliothecula.db</span>
    <span class="pl-c1">python3 3.7.3 (default, Jan 22 2021, 20:04:44) [GCC 8.3.0]</span>
    <span class="pl-c1">                            bibliothecula shell 📇 📚 🏷️ 🦇</span>
    <span class="pl-c1">       (_    ,_,    _)</span>
    <span class="pl-c1">       / `'--) (--'` \      exported objects:</span>
    <span class="pl-c1">      /  _,-'\_/'-,_  \      - conn : sqlite3.Connection</span>
    <span class="pl-c1">     /.-'     "     '-.\     -   db : Database (see NAMESPACE dict</span>
    <span class="pl-c1">        ______ ______                            for every  import)</span>
    <span class="pl-c1">      _/      Y      \_       &gt;&gt;&gt; help(db)</span>
    <span class="pl-c1">     // ~~ ~~ | ~~ ~  \\      &gt;&gt;&gt; help(conn)</span>
    <span class="pl-c1">    // ~ ~ ~~ | ~~~ ~~ \\     &gt;&gt;&gt; print(LONG_SHELL_BANNER)</span>
    <span class="pl-c1">   //________.|.________\\    &gt;&gt;&gt; db.stats()</span>
    <span class="pl-c1">  `----------`-'----------'</span>

    <span class="pl-c1">Connected to bibliothecula.db, last modified 2021-06-21 00:07</span>
    <span class="pl-c1">&gt;&gt;&gt;</span></pre>
  </div>
  <footer>
    <a rel="me" style="display: none;" href="https://chaos.social/@epilys"></a> <a rel="me" href="https://github.com/epilys/bibliothecula" class="repo">https://<wbr>github<wbr>.<wbr>com<wbr>/<wbr>epilys<wbr>/<wbr>bibliothecula</a> <a rel="external nofollow" href="https://www.gnu.org/licenses/gpl-3.0-standalone.html" class="gpl"><small><abbr class="gpl" title="The GNU General Public License v3.0">GPLv3</abbr></small></a>
  </footer>
</body>
</html>
